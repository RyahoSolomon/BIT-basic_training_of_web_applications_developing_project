<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <link rel="stylesheet" href="css/styles_login.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
</head>
<body>
    <video src="mov/background.mp4" class="index-video" autoplay="autoplay" loop="loop" muted="muted"></video>
    <div class="header">
        <img src="img/logo.png" alt="Logo">
    </div>
    <div class="login-container">
        <div class="login-box">
            <h2><strong>登录</strong> &nbsp;</h2>
            <form id="loginForm">
                <div class="input-group">
                    <label for="username">账号</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="input-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div class="input-group">
                    <button type="submit" class="btn">开启仙魔之旅</button>
                </div>
                <div class="forgot-password">
                    <a href="register.html">注册账号</a> / <a href="find_password.html">忘记密码</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 处理登录表单的提交事件
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault(); // 阻止表单默认提交行为

            var username = document.getElementById('username').value;
            var password = document.getElementById('password').value;
            /*var isHad = false; //定义一个开关变量
			var index = 0; //定义一个下标确定用户

            if(window.localStorage.userArr){
                var array = JSON.parse(window.localStorage.userArr);
            }else{
                alert("请先注册一个用户");
				return;
            }

            for (var i = 0; i < array.length; i++) {
                if (username_text == array[i].username) {  //有这个账号
                    isHad = true;
                    index = i;
                }
            }

            if (isHad) {  //如果存在
                if (password_text == array[index].password) {
                    
                    alert('登录成功！欢迎回来，' + username + '!');
                    window.location.href = "../story/chapter0/temp.html";
                    return;
                }
                else {
                    alert("密码错误，请重试");
                }
            } else {
                alert('未找到该用户名，请先注册');
            }*/
            // 从LocalStorage中获取用户数据
            var storedUser = localStorage.getItem(username);

            if (storedUser) {
                var userData = JSON.parse(storedUser);

                // 验证密码
                if (userData.password === password) {
                    alert('登录成功！欢迎回来，' + username + '!');
                    // 登录成功后，你可以将用户重定向到游戏主界面或其他页面
                    window.localStorage.setItem('username',username);
                    
                    window.location.href = '_INDEX.html'; // 假设main.html是游戏的主页面
                    
                } else {
                    alert('密码错误，请重试');
                }
            } else {
                alert('未找到该用户名，请先注册');
            }
        });
    </script>
</body>
</html>